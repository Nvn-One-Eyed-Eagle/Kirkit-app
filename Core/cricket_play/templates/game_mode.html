{% extends "base.html" %}

{% block title %}Game Mode{% endblock %}

{% block content %}
<div class="game-container">
  <!-- Teams List -->
  <section class="teams-box">
    <h2>Teams</h2>
    <ul id="teams-list">
      {% for team in teams %}
        <li>{{ team.0 }} &amp; {{ team.1 }}</li>
      {% endfor %}
    </ul>

    {% if common %}
      <p class="common-player">Left out player (common): <strong>{{ common }}</strong></p>
    {% endif %}
  </section>

  <hr>

  <!-- Toss Section -->
  <section class="toss-box">
    <h2>ðŸª™ Toss</h2>
    <div id="coin" class="coin">?</div>
    <button id="flipBtn" class="btn-primary">Flip Coin</button>
    <p id="tossResult"></p>
  </section>

  <!-- Hidden Form -->
  <form method="POST" action="{% url 'main' %}" id="orderForm">
      {% csrf_token %}
      <input type="hidden" name="batting_order" id="batting_order">
      <button type="submit" id="startMatchBtn" class="btn-success" style="display:none;">Start Match</button>
  </form>
</div>

<style>
  /* Container */
  .game-container {
    max-width: 500px;
    margin: 20px auto;
    background: #f9fff9;
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    text-align: center;
    font-family: Arial, sans-serif;
  }

  /* Teams */
  .teams-box {
    margin-bottom: 20px;
  }
  .teams-box h2 {
    color: #006400;
    margin-bottom: 10px;
  }
  #teams-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  #teams-list li {
    background: #fff;
    border: 1px solid #ddd;
    margin: 6px 0;
    padding: 10px;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }
  .common-player {
    margin-top: 10px;
    font-size: 14px;
    color: #444;
  }

  /* Toss */
  .toss-box h2 {
    margin: 10px 0;
    color: #006400;
  }
  .coin {
    width: 140px;
    height: 140px;
    margin: 20px auto;
    border-radius: 50%;
    background: radial-gradient(circle, gold 60%, #b8860b 100%);
    border: 4px solid #333;
    line-height: 140px;
    font-weight: bold;
    font-size: 22px;
    text-align: center;
    color: #222;
    box-shadow: 0 0 20px rgba(218,165,32,0.6), 0 0 10px rgba(0,0,0,0.2);
    transition: transform 1s;
    perspective: 1000px;
  }
  .coin.flip {
    animation: spin 1s linear infinite;
  }
  @keyframes spin {
    0% { transform: rotateY(0deg); }
    50% { transform: rotateY(180deg); }
    100% { transform: rotateY(360deg); }
  }

  /* Buttons */
  .btn-primary {
    background: #006400;
    color: gold;
    font-weight: bold;
    border: none;
    padding: 12px 20px;
    margin: 10px auto;
    border-radius: 10px;
    cursor: pointer;
    transition: 0.3s;
  }
  .btn-primary:hover {
    background: #228b22;
  }

  .btn-success {
    background: #daa520;
    color: #fff;
    font-weight: bold;
    border: none;
    padding: 12px 20px;
    margin-top: 15px;
    border-radius: 10px;
    cursor: pointer;
    transition: 0.3s;
    display: block;
    width: 100%;
  }
  .btn-success:hover {
    background: #b8860b;
  }

  /* Toss result */
  #tossResult {
    margin-top: 15px;
    font-size: 16px;
    font-weight: bold;
    color: #333;
    white-space: pre-line;
  }
</style>

<script>
  const flipBtn = document.getElementById("flipBtn");
  const coin = document.getElementById("coin");
  const result = document.getElementById("tossResult");

  const teams = [
    {% for team in teams %}
      "{{ team.0 }} & {{ team.1 }}"{% if not forloop.last %},{% endif %}
    {% endfor %}
  ];

  flipBtn.addEventListener("click", function() {
    result.innerText = "";
    coin.innerText = "?";
    coin.classList.add("flip");

    setTimeout(() => {
      coin.classList.remove("flip");
      const isHeads = Math.random() > 0.5;
      coin.innerText = isHeads ? "HEADS" : "TAILS";

      let order = [];

      if (teams.length === 2) {
        const first = isHeads ? teams[0] : teams[1];
        const second = isHeads ? teams[1] : teams[0];
        order = [first, second];
        result.innerText = `${first} bats first, then ${second}.`;
      } 
      else if (teams.length === 3) {
        order = [...teams].sort(() => 0.5 - Math.random());
        result.innerText = `Batting order:\n1) ${order[0]}\n2) ${order[1]}\n3) ${order[2]}`;
      } 
      else {
        result.innerText = "Need 2 or 3 teams for toss!";
      }

      document.getElementById("batting_order").value = JSON.stringify(order);
      document.getElementById("startMatchBtn").style.display = "block";
    }, 1500);
  });
</script>
{% endblock %}
